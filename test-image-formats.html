<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Formatos de Imagen - RecetasWorld</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .format-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .format-card {
            border: 1px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
            background: white;
            text-align: center;
        }
        .format-info {
            padding: 15px;
        }
        .format-name {
            font-weight: bold;
            font-size: 18px;
            margin-bottom: 10px;
        }
        .support-status {
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            margin: 5px;
        }
        .support-status.supported { background: #d4edda; color: #155724; }
        .support-status.limited { background: #fff3cd; color: #856404; }
        .support-status.unsupported { background: #f8d7da; color: #721c24; }
        .upload-area {
            border: 2px dashed #ddd;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .upload-area:hover {
            border-color: #007bff;
            background: #f8f9fa;
        }
        .upload-area.dragover {
            border-color: #007bff;
            background: #e3f2fd;
        }
        .preview-container {
            margin: 20px 0;
            text-align: center;
        }
        .preview-image {
            max-width: 100%;
            max-height: 300px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .file-info {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 12px;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        .compatibility-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        .compatibility-table th,
        .compatibility-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }
        .compatibility-table th {
            background: #f8f9fa;
            font-weight: bold;
        }
        .yes { color: #28a745; font-weight: bold; }
        .no { color: #dc3545; font-weight: bold; }
        .partial { color: #ffc107; font-weight: bold; }
    </style>
</head>
<body>
    <h1>üñºÔ∏è Test de Formatos de Imagen - RecetasWorld</h1>
    
    <div class="test-section">
        <h2>üì§ Prueba de Subida</h2>
        <div class="upload-area" id="uploadArea">
            <i style="font-size: 48px; color: #ddd;">üìÅ</i>
            <p>Arrastra una imagen aqu√≠ o haz clic para seleccionar</p>
            <p><small>Soporta: PNG, JPG, GIF, WebP, BMP, TIFF, SVG, AVIF, HEIC, HEIF</small></p>
            <input type="file" id="fileInput" accept="image/*" style="display: none;">
        </div>
        
        <div id="previewContainer" class="preview-container" style="display: none;">
            <h3>Vista Previa</h3>
            <img id="previewImage" class="preview-image" alt="Vista previa">
            <div id="fileInfo" class="file-info"></div>
            <button onclick="clearPreview()">Limpiar</button>
        </div>
    </div>

    <div class="test-section">
        <h2>üåê Compatibilidad de Navegadores</h2>
        <table class="compatibility-table">
            <thead>
                <tr>
                    <th>Formato</th>
                    <th>Chrome</th>
                    <th>Firefox</th>
                    <th>Safari</th>
                    <th>Edge</th>
                    <th>M√≥viles</th>
                    <th>Recomendaci√≥n</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>PNG</strong></td>
                    <td class="yes">‚úÖ</td>
                    <td class="yes">‚úÖ</td>
                    <td class="yes">‚úÖ</td>
                    <td class="yes">‚úÖ</td>
                    <td class="yes">‚úÖ</td>
                    <td>Universal - Perfecto para transparencias</td>
                </tr>
                <tr>
                    <td><strong>JPG/JPEG</strong></td>
                    <td class="yes">‚úÖ</td>
                    <td class="yes">‚úÖ</td>
                    <td class="yes">‚úÖ</td>
                    <td class="yes">‚úÖ</td>
                    <td class="yes">‚úÖ</td>
                    <td>Universal - Mejor para fotos</td>
                </tr>
                <tr>
                    <td><strong>GIF</strong></td>
                    <td class="yes">‚úÖ</td>
                    <td class="yes">‚úÖ</td>
                    <td class="yes">‚úÖ</td>
                    <td class="yes">‚úÖ</td>
                    <td class="yes">‚úÖ</td>
                    <td>Universal - Animaciones simples</td>
                </tr>
                <tr>
                    <td><strong>WebP</strong></td>
                    <td class="yes">‚úÖ</td>
                    <td class="yes">‚úÖ</td>
                    <td class="yes">‚úÖ</td>
                    <td class="yes">‚úÖ</td>
                    <td class="yes">‚úÖ</td>
                    <td>Moderno - Mejor compresi√≥n</td>
                </tr>
                <tr>
                    <td><strong>AVIF</strong></td>
                    <td class="yes">‚úÖ</td>
                    <td class="yes">‚úÖ</td>
                    <td class="partial">‚ö†Ô∏è</td>
                    <td class="yes">‚úÖ</td>
                    <td class="partial">‚ö†Ô∏è</td>
                    <td>Muy moderno - Excelente compresi√≥n</td>
                </tr>
                <tr>
                    <td><strong>SVG</strong></td>
                    <td class="yes">‚úÖ</td>
                    <td class="yes">‚úÖ</td>
                    <td class="yes">‚úÖ</td>
                    <td class="yes">‚úÖ</td>
                    <td class="yes">‚úÖ</td>
                    <td>Vectorial - Perfecto para iconos</td>
                </tr>
                <tr>
                    <td><strong>BMP</strong></td>
                    <td class="yes">‚úÖ</td>
                    <td class="yes">‚úÖ</td>
                    <td class="yes">‚úÖ</td>
                    <td class="yes">‚úÖ</td>
                    <td class="partial">‚ö†Ô∏è</td>
                    <td>Antiguo - Se convierte a JPG</td>
                </tr>
                <tr>
                    <td><strong>TIFF</strong></td>
                    <td class="partial">‚ö†Ô∏è</td>
                    <td class="partial">‚ö†Ô∏è</td>
                    <td class="yes">‚úÖ</td>
                    <td class="partial">‚ö†Ô∏è</td>
                    <td class="no">‚ùå</td>
                    <td>Profesional - Se convierte a JPG</td>
                </tr>
                <tr>
                    <td><strong>HEIC/HEIF</strong></td>
                    <td class="no">‚ùå</td>
                    <td class="no">‚ùå</td>
                    <td class="yes">‚úÖ</td>
                    <td class="no">‚ùå</td>
                    <td class="partial">‚ö†Ô∏è</td>
                    <td>iOS - Se convierte a JPG</td>
                </tr>
            </tbody>
        </table>
    </div>

    <div class="test-section">
        <h2>üîß Detecci√≥n de Soporte</h2>
        <div id="supportDetection">
            <p>Detectando soporte del navegador actual...</p>
        </div>
    </div>

    <div class="test-section">
        <h2>üìä Estad√≠sticas de Formato</h2>
        <div class="format-grid" id="formatStats">
            <!-- Se llenar√°n din√°micamente -->
        </div>
    </div>

    <script>
        class ImageFormatTester {
            constructor() {
                this.supportedFormats = {};
                this.init();
            }

            init() {
                this.setupUploadArea();
                this.detectFormatSupport();
                this.displayFormatStats();
            }

            setupUploadArea() {
                const uploadArea = document.getElementById('uploadArea');
                const fileInput = document.getElementById('fileInput');

                uploadArea.addEventListener('click', () => fileInput.click());
                
                uploadArea.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    uploadArea.classList.add('dragover');
                });

                uploadArea.addEventListener('dragleave', () => {
                    uploadArea.classList.remove('dragover');
                });

                uploadArea.addEventListener('drop', (e) => {
                    e.preventDefault();
                    uploadArea.classList.remove('dragover');
                    const files = e.dataTransfer.files;
                    if (files.length > 0) {
                        this.handleFile(files[0]);
                    }
                });

                fileInput.addEventListener('change', (e) => {
                    if (e.target.files.length > 0) {
                        this.handleFile(e.target.files[0]);
                    }
                });
            }

            handleFile(file) {
                console.log('Archivo seleccionado:', file);

                // Mostrar informaci√≥n del archivo
                const fileInfo = document.getElementById('fileInfo');
                const format = file.type.split('/')[1] || 'desconocido';
                
                fileInfo.innerHTML = `
                    <strong>Informaci√≥n del archivo:</strong><br>
                    Nombre: ${file.name}<br>
                    Tipo MIME: ${file.type}<br>
                    Formato: ${format.toUpperCase()}<br>
                    Tama√±o: ${(file.size / 1024 / 1024).toFixed(2)} MB<br>
                    √öltima modificaci√≥n: ${new Date(file.lastModified).toLocaleString()}<br>
                    <strong>Estado:</strong> ${this.getFormatStatus(format)}
                `;

                // Mostrar vista previa
                const reader = new FileReader();
                reader.onload = (e) => {
                    const previewImage = document.getElementById('previewImage');
                    const previewContainer = document.getElementById('previewContainer');
                    
                    previewImage.src = e.target.result;
                    previewContainer.style.display = 'block';

                    // Verificar si la imagen se carga correctamente
                    previewImage.onload = () => {
                        console.log('‚úÖ Imagen cargada correctamente');
                        fileInfo.innerHTML += '<br><span style="color: green;">‚úÖ Se muestra correctamente en este navegador</span>';
                    };

                    previewImage.onerror = () => {
                        console.log('‚ùå Error cargando imagen');
                        fileInfo.innerHTML += '<br><span style="color: red;">‚ùå No se puede mostrar en este navegador</span>';
                        previewImage.style.display = 'none';
                    };
                };

                reader.readAsDataURL(file);
            }

            getFormatStatus(format) {
                const universalFormats = ['png', 'jpg', 'jpeg', 'gif'];
                const modernFormats = ['webp', 'avif'];
                const specializedFormats = ['svg', 'bmp', 'tiff', 'tif'];
                const mobileFormats = ['heic', 'heif'];

                if (universalFormats.includes(format.toLowerCase())) {
                    return '<span style="color: green;">‚úÖ Soporte universal</span>';
                } else if (modernFormats.includes(format.toLowerCase())) {
                    return '<span style="color: blue;">üöÄ Formato moderno</span>';
                } else if (specializedFormats.includes(format.toLowerCase())) {
                    return '<span style="color: orange;">‚ö†Ô∏è Soporte limitado - se convertir√° autom√°ticamente</span>';
                } else if (mobileFormats.includes(format.toLowerCase())) {
                    return '<span style="color: purple;">üì± Formato m√≥vil - se convertir√° autom√°ticamente</span>';
                } else {
                    return '<span style="color: red;">‚ùì Formato desconocido</span>';
                }
            }

            detectFormatSupport() {
                const canvas = document.createElement('canvas');
                canvas.width = 1;
                canvas.height = 1;

                // Detectar WebP
                const webpSupport = canvas.toDataURL('image/webp').indexOf('data:image/webp') === 0;
                
                // Detectar AVIF (m√©todo m√°s confiable)
                const avifImg = new Image();
                avifImg.onload = () => {
                    this.supportedFormats.avif = true;
                    this.updateSupportDisplay();
                };
                avifImg.onerror = () => {
                    this.supportedFormats.avif = false;
                    this.updateSupportDisplay();
                };
                avifImg.src = 'data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgABogQEAwgMg8f8D///8WfhwB8+ErK42A=';

                this.supportedFormats.webp = webpSupport;
                this.supportedFormats.png = true;
                this.supportedFormats.jpg = true;
                this.supportedFormats.gif = true;
                this.supportedFormats.svg = true;
                this.supportedFormats.bmp = true;

                this.updateSupportDisplay();
            }

            updateSupportDisplay() {
                const supportDiv = document.getElementById('supportDetection');
                
                supportDiv.innerHTML = `
                    <h3>Soporte detectado en tu navegador:</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px;">
                        ${Object.entries(this.supportedFormats).map(([format, supported]) => `
                            <div class="support-status ${supported ? 'supported' : 'unsupported'}">
                                ${format.toUpperCase()}: ${supported ? '‚úÖ' : '‚ùå'}
                            </div>
                        `).join('')}
                    </div>
                    <p><small>Navegador: ${navigator.userAgent.split(' ').pop()}</small></p>
                `;
            }

            displayFormatStats() {
                const formats = [
                    {
                        name: 'PNG',
                        description: 'Portable Network Graphics',
                        pros: ['Transparencia', 'Sin p√©rdida', 'Universal'],
                        cons: ['Archivos grandes'],
                        usage: 'Logos, iconos, im√°genes con transparencia'
                    },
                    {
                        name: 'JPG/JPEG',
                        description: 'Joint Photographic Experts Group',
                        pros: ['Archivos peque√±os', 'Universal', 'Bueno para fotos'],
                        cons: ['Con p√©rdida', 'Sin transparencia'],
                        usage: 'Fotograf√≠as, im√°genes complejas'
                    },
                    {
                        name: 'WebP',
                        description: 'Web Picture format',
                        pros: ['Excelente compresi√≥n', 'Transparencia', 'Animaci√≥n'],
                        cons: ['Soporte limitado en navegadores antiguos'],
                        usage: 'Web moderna, mejor alternativa a PNG/JPG'
                    },
                    {
                        name: 'AVIF',
                        description: 'AV1 Image File Format',
                        pros: ['Mejor compresi√≥n que WebP', 'Calidad superior'],
                        cons: ['Soporte muy limitado', 'Procesamiento lento'],
                        usage: 'Futuro de im√°genes web'
                    },
                    {
                        name: 'HEIC/HEIF',
                        description: 'High Efficiency Image Container',
                        pros: ['Excelente compresi√≥n', 'Metadatos ricos'],
                        cons: ['Solo iOS/macOS', 'Sin soporte web'],
                        usage: 'Fotos de iPhone/iPad'
                    }
                ];

                const statsContainer = document.getElementById('formatStats');
                statsContainer.innerHTML = formats.map(format => `
                    <div class="format-card">
                        <div class="format-info">
                            <div class="format-name">${format.name}</div>
                            <p><small>${format.description}</small></p>
                            <div style="text-align: left; margin: 10px 0;">
                                <strong>Ventajas:</strong>
                                <ul style="margin: 5px 0; padding-left: 20px;">
                                    ${format.pros.map(pro => `<li>${pro}</li>`).join('')}
                                </ul>
                                <strong>Desventajas:</strong>
                                <ul style="margin: 5px 0; padding-left: 20px;">
                                    ${format.cons.map(con => `<li>${con}</li>`).join('')}
                                </ul>
                                <strong>Uso recomendado:</strong>
                                <p style="margin: 5px 0; font-size: 12px;">${format.usage}</p>
                            </div>
                        </div>
                    </div>
                `).join('');
            }
        }

        function clearPreview() {
            document.getElementById('previewContainer').style.display = 'none';
            document.getElementById('fileInput').value = '';
        }

        // Inicializar cuando la p√°gina cargue
        window.addEventListener('DOMContentLoaded', () => {
            new ImageFormatTester();
        });
    </script>
</body>
</html>